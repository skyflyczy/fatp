ext {
    deployType = "war"
    deployDir = new File(project.buildDir, "/deploy")
}

// 准备部署需要的目录结构
task prepareDeploy(dependsOn: "assemble") {
    doLast {
        if (deployType == "jar") {
            copy {
                from configurations.runtime
                into "$deployDir/lib"
            }
            copy {
                with jar
                into deployDir
            }
        } else if (deployType == "war") {
            copy {
                from 'webapps'
                into deployDir
                with war
            }
        } else {
            println "Unsupported deploy type: $deployType"
        }
    }
}

build {
    dependsOn "prepareDeploy"
}
